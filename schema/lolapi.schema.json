{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LOLAPI Entry Schema",
  "description": "Schema for Living Off The Land API entries",
  "type": "object",
  "required": [
    "id",
    "name",
    "category",
    "subcategory",
    "api",
    "abuse_scenarios",
    "detection",
    "mitigation",
    "risk",
    "references",
    "tags",
    "author",
    "created"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "UUID identifier for the API entry"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 256,
      "description": "Human-readable name of the API"
    },
    "category": {
      "type": "string",
      "enum": [
        "windows-dotnet-api",
        "windows-com",
        "windows-api",
        "browser-extension",
        "cloud-metadata",
        "script-engine"
      ],
      "description": "Broad category of the API"
    },
    "subcategory": {
      "type": "string",
      "description": "More granular categorization (e.g., process-execution, network-communication)"
    },
    "api": {
      "type": "object",
      "required": ["namespace", "language", "documentation"],
      "properties": {
        "namespace": {
          "type": "string",
          "description": "API namespace or module (e.g., System.Diagnostics)"
        },
        "class": {
          "type": "string",
          "description": "Class name if applicable"
        },
        "method": {
          "type": "string",
          "description": "Method/function name"
        },
        "language": {
          "type": "string",
          "description": "Programming language or runtime (e.g., .NET 4.0+, C/C++)"
        },
        "documentation": {
          "type": "string",
          "format": "uri",
          "description": "Link to official documentation"
        }
      }
    },
    "abuse_scenarios": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "description", "code_snippet"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the abuse scenario"
          },
          "technique_id": {
            "type": "string",
            "description": "MITRE ATT&CK technique ID (e.g., T1059)"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of the abuse"
          },
          "code_snippet": {
            "type": "string",
            "description": "Example code demonstrating the abuse"
          },
          "detection_difficulty": {
            "type": "string",
            "enum": ["easy", "medium", "hard"],
            "description": "How difficult to detect this abuse"
          },
          "common_in_campaigns": {
            "type": "boolean",
            "description": "Whether seen in real-world attack campaigns"
          },
          "evasion_techniques": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Evasion techniques commonly paired with this abuse"
          },
          "references": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            }
          }
        }
      }
    },
    "detection": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "vendor": {
            "type": "string",
            "description": "Security vendor or tool (e.g., Microsoft Defender)"
          },
          "capability": {
            "type": "string",
            "description": "Type of detection capability"
          },
          "effectiveness": {
            "type": "string",
            "enum": ["low", "medium", "high"],
            "description": "How effective this detection is"
          },
          "query": {
            "type": "string",
            "description": "Detection query (Sigma, Splunk, etc.)"
          },
          "notes": {
            "type": "string",
            "description": "Additional context about the detection"
          }
        }
      }
    },
    "mitigation": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "category": {
            "type": "string",
            "enum": ["policy", "hardening", "detection", "monitoring"],
            "description": "Type of mitigation"
          },
          "description": {
            "type": "string",
            "description": "What the mitigation does"
          },
          "feasibility": {
            "type": "string",
            "enum": ["easy", "medium", "hard"],
            "description": "How feasible this mitigation is"
          }
        }
      }
    },
    "risk": {
      "type": "object",
      "required": ["severity", "ease_of_abuse"],
      "properties": {
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "description": "Impact severity"
        },
        "prevalence": {
          "type": "string",
          "enum": ["novel", "emerging", "widespread"],
          "description": "How prevalent in the wild"
        },
        "ease_of_abuse": {
          "type": "string",
          "enum": ["easy", "medium", "hard"],
          "description": "How easy for attackers to abuse"
        },
        "likelihood_in_real_attacks": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage likelihood in real attacks"
        }
      }
    },
    "references": {
      "type": "object",
      "properties": {
        "techniques": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "MITRE ATT&CK technique IDs"
        },
        "tools": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Known tools that abuse this API"
        },
        "campaigns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "year": {
                "type": "integer"
              },
              "source": {
                "type": "string",
                "format": "uri"
              }
            }
          }
        }
      }
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Tags for categorization and search"
    },
    "author": {
      "type": "string",
      "description": "Author/contributor name"
    },
    "created": {
      "type": "string",
      "format": "date",
      "description": "Creation date (YYYY-MM-DD)"
    },
    "updated": {
      "type": "string",
      "format": "date",
      "description": "Last update date (YYYY-MM-DD)"
    },
    "verified": {
      "type": "boolean",
      "description": "Whether the entry has been verified"
    },
    "notes": {
      "type": "string",
      "description": "Additional notes and context"
    }
  }
}
